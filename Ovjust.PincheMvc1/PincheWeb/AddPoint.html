<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style type="text/css">
		body, html{width: 100%;height: 100%; margin:0;font-family:"微软雅黑";}
		#l-map{height:300px;width:100%;}
		#r-result{width:100%;}
	</style>
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=4c77ac8f8318a8c1b226cd83b434cf32"></script>
    <script src="../Scripts/jquery-1.8.3.js"></script>
	<title>浏览器定位</title>
</head>
<body>
    <div>
    
        </div>
    <div>
       城市<input type="text" id="txtCity" placeholder="正在定位中..." /><input type="button" id="btnChangeCity" value="更改"  style="display:none;"/>
        地点<input type="text" id="txtAddress" disabled="disabled" /> <input type="button" id="btnSelectFromMap"  value="从地图选点" disabled="disabled"/><br />
        别名<input type="text" id="txtName" disabled="disabled" placeholder="如公司、家"/> 
      
        <input type="button" id="btnSave" value="保存" />
    </div>
  

    <div id="divPopupMap" >
        <h1 id="mapTitle"></h1>
	<div id="l-map"></div>
	<div id="r-result"></div>
    </div>

</body>
</html>
<script>
    var city1,  address1,  point1, name1;

    // 百度地图API功能
    var map = new BMap.Map("l-map");
    var point = new BMap.Point(116.331398, 39.897445);
    var mark;
    map.centerAndZoom(point, 12);
    map.enableScrollWheelZoom(true);
    map.enableDragging();
    var geolocation = new BMap.Geolocation();

    //disable其它的，等待定位
    geolocation.getCurrentPosition(function (r) {
        if (this.getStatus() == BMAP_STATUS_SUCCESS) {
            mark = new BMap.Marker(r.point);
            map.addOverlay(mark);
            map.panTo(r.point);
            //alert('您的位置：' + r.point.lng + ',' + r.point.lat);
            $('#txtCity').val(r.address.city);
            city1 = r.address.city;
        }
        else {
            //alert('failed' + this.getStatus());
            $('#txtCity1,#txtCity2').attr('placeholder', '定位失败，请手动输入');
            $('#btnChangeCity1,btnChangeCity2').prop('disabled', false);
        }
    }, { enableHighAccuracy: true })
    //关于状态码
    //BMAP_STATUS_SUCCESS	检索成功。对应数值“0”。
    //BMAP_STATUS_CITY_LIST	城市列表。对应数值“1”。
    //BMAP_STATUS_UNKNOWN_LOCATION	位置结果未知。对应数值“2”。
    //BMAP_STATUS_UNKNOWN_ROUTE	导航结果未知。对应数值“3”。
    //BMAP_STATUS_INVALID_KEY	非法密钥。对应数值“4”。
    //BMAP_STATUS_INVALID_REQUEST	非法请求。对应数值“5”。
    //BMAP_STATUS_PERMISSION_DENIED	没有权限。对应数值“6”。(自 1.1 新增)
    //BMAP_STATUS_SERVICE_UNAVAILABLE	服务不可用。对应数值“7”。(自 1.1 新增)
    //BMAP_STATUS_TIMEOUT	超时。对应数值“8”。(自 1.1 新增)

    //更改城市
    $('#btnChangeCity').click(function () {

    });

    var searchingTextId;
    var localSearch;
    var selectPointType;
    //检查输入地点是否正确
    $('#txtAddress').change(function () {
        var idCity;
        searchingTextId = $(this).id;
        if (searchingTextId == 'txtStart')
            idCity = 'txtCity1';
        else
            idCity = 'txtCity2';
        map.centerAndZoom($('#' + idCity).val(), 12);
        localSearch = new BMap.LocalSearch(map, optionsLocalSearch);
        localSearch.search($(this).val());
    });
    var optionsLocalSearch = {
        renderOptions: { map: map, panel: "r-result" },
        onSearchComplete: function (results) {
            // 判断状态是否正确
            if (local.getStatus() == BMAP_STATUS_SUCCESS) {
                var pointsCount = results.getCurrentNumPois();
                if (pointsCount == 0)
                    alert('地点“' + $('#' + searchingTextId).val() + '”定位失败,请重新输入');
                else if (pointsCount == 1) { }
                else {
                    $('#mapTitle').text('请选择地点：');
                    $('#divPopupMap').show();
                    selectPointType = 1;
                }
                //var s = [];
                //for (var i = 0; i < results.getCurrentNumPois() ; i++) {
                //    s.push(results.getPoi(i).title + ", " + results.getPoi(i).address);
                //}
                //document.getElementById("r-result").innerHTML = s.join("<br/>");
            }
            else {
                alert('地点“' + $('#' + searchingTextId).val() + '”定位失败,请重新输入');
            }
        }
    };
    $('#btnSelectPoint').click(function () {
        var selectedPoint = map.getCurrentPosition();
        if (selectPointType == 1) {

        }
        else {

        }
    });

    //从地图选点
    $('#btnSelectFromMap1,#btnSelectFromMap2').click(function () {
        $('#mapTitle').text('请选择地点：');
        $('#divPopupMap').show();
        selectPointType = 2;
        marker.enableDragging();
    });

    

</script>
